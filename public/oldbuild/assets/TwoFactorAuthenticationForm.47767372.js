import{h as _,V as I,o as t,f as a,a as c,r as N,b as n,w as o,k as r,t as i,P as R,n as k,O as E,g as Q,d as O,s as U,c as w,u as h,j as f,F as j,l as z,B as D,p as B}from"./app.af699bdb.js";import{b as Y,a as G}from"./DialogModal.2a6fb390.js";import{_ as A,a as L}from"./TextInput.b6356004.js";import{_ as F}from"./PrimaryButton.53fd8893.js";import{_ as $}from"./SecondaryButton.addb0e31.js";import{_ as J}from"./DangerButton.9f72b542.js";import{_ as W}from"./InputLabel.f9376689.js";import"./SectionTitle.0a4f5585.js";import"./_plugin-vue_export-helper.cdc0426e.js";const X={class:"mt-4"},g={__name:"ConfirmsPassword",props:{title:{type:String,default:"Confirm Password"},content:{type:String,default:"For your security, please confirm your password to continue."},button:{type:String,default:"Confirm"}},emits:["confirmed"],setup(b,{emit:x}){const u=_(!1),e=I({password:"",error:"",processing:!1}),d=_(null),y=()=>{axios.get(route("password.confirmation")).then(l=>{l.data.confirmed?x("confirmed"):(u.value=!0,setTimeout(()=>d.value.focus(),250))})},v=()=>{e.processing=!0,axios.post(route("password.confirm"),{password:e.password}).then(()=>{e.processing=!1,m(),E().then(()=>x("confirmed"))}).catch(l=>{e.processing=!1,e.error=l.response.data.errors.password[0],d.value.focus()})},m=()=>{u.value=!1,e.password="",e.error=""};return(l,p)=>(t(),a("span",null,[c("span",{onClick:y},[N(l.$slots,"default")]),n(Y,{show:u.value,onClose:m},{title:o(()=>[r(i(b.title),1)]),content:o(()=>[r(i(b.content)+" ",1),c("div",X,[n(A,{ref_key:"passwordInput",ref:d,modelValue:e.password,"onUpdate:modelValue":p[0]||(p[0]=S=>e.password=S),type:"password",class:"mt-1 block w-3/4",placeholder:"Password",onKeyup:R(v,["enter"])},null,8,["modelValue","onKeyup"]),n(L,{message:e.error,class:"mt-2"},null,8,["message"])])]),footer:o(()=>[n($,{onClick:m},{default:o(()=>[r(" Cancel ")]),_:1}),n(F,{class:k(["ml-3",{"opacity-25":e.processing}]),disabled:e.processing,onClick:v},{default:o(()=>[r(i(b.button),1)]),_:1},8,["class","disabled"])]),_:1},8,["show"])]))}},Z={key:0,class:"text-lg font-medium text-gray-900"},ee={key:1,class:"text-lg font-medium text-gray-900"},te={key:2,class:"text-lg font-medium text-gray-900"},oe={class:"mt-3 max-w-xl text-sm text-gray-600"},se={key:3},ae={key:0},ne={class:"mt-4 max-w-xl text-sm text-gray-600"},re={key:0,class:"font-semibold"},le={key:1},ie=["innerHTML"],ce={key:0,class:"mt-4 max-w-xl text-sm text-gray-600"},ue={class:"font-semibold"},de=["innerHTML"],fe={key:1,class:"mt-4"},me={key:1},pe=c("div",{class:"mt-4 max-w-xl text-sm text-gray-600"},[c("p",{class:"font-semibold"}," Store these recovery codes in a secure password manager. They can be used to recover access to your account if your two factor authentication device is lost. ")],-1),_e={class:"grid gap-1 max-w-xl mt-4 px-4 py-4 font-mono text-sm bg-gray-100 rounded-lg"},ve={class:"mt-5"},he={key:0},ye={key:1},Fe={__name:"TwoFactorAuthenticationForm",props:{requiresConfirmation:Boolean},setup(b){const x=b,u=_(!1),e=_(!1),d=_(!1),y=_(null),v=_(null),m=_([]),l=Q({code:""}),p=O(()=>{var s;return!u.value&&((s=D().props.value.user)==null?void 0:s.two_factor_enabled)});U(p,()=>{p.value||(l.reset(),l.clearErrors())});const S=()=>{u.value=!0,B.Inertia.post("/user/two-factor-authentication",{},{preserveScroll:!0,onSuccess:()=>Promise.all([M(),q(),T()]),onFinish:()=>{u.value=!1,e.value=x.requiresConfirmation}})},M=()=>axios.get("/user/two-factor-qr-code").then(s=>{y.value=s.data.svg}),q=()=>axios.get("/user/two-factor-secret-key").then(s=>{v.value=s.data.secretKey}),T=()=>axios.get("/user/two-factor-recovery-codes").then(s=>{m.value=s.data}),V=()=>{l.post("/user/confirmed-two-factor-authentication",{errorBag:"confirmTwoFactorAuthentication",preserveScroll:!0,preserveState:!0,onSuccess:()=>{e.value=!1,y.value=null,v.value=null}})},H=()=>{axios.post("/user/two-factor-recovery-codes").then(()=>T())},P=()=>{d.value=!0,B.Inertia.delete("/user/two-factor-authentication",{preserveScroll:!0,onSuccess:()=>{d.value=!1,e.value=!1}})};return(s,K)=>(t(),w(G,null,{title:o(()=>[r(i(s.$t("profile.two_factor_authentication.title")),1)]),description:o(()=>[r(i(s.$t("profile.two_factor_authentication.description")),1)]),content:o(()=>[h(p)&&!e.value?(t(),a("h3",Z," You have enabled two factor authentication. ")):h(p)&&e.value?(t(),a("h3",ee," Finish enabling two factor authentication. ")):(t(),a("h3",te,i(s.$t("profile.two_factor_authentication.card_title")),1)),c("div",oe,[c("p",null,i(s.$t("profile.two_factor_authentication.card_content")),1)]),h(p)?(t(),a("div",se,[y.value?(t(),a("div",ae,[c("div",ne,[e.value?(t(),a("p",re," To finish enabling two factor authentication, scan the following QR code using your phone's authenticator application or enter the setup key and provide the generated OTP code. ")):(t(),a("p",le," Two factor authentication is now enabled. Scan the following QR code using your phone's authenticator application or enter the setup key. "))]),c("div",{class:"mt-4",innerHTML:y.value},null,8,ie),v.value?(t(),a("div",ce,[c("p",ue,[r(" Setup Key: "),c("span",{innerHTML:v.value},null,8,de)])])):f("",!0),e.value?(t(),a("div",fe,[n(W,{for:"code",value:"Code"}),n(A,{id:"code",modelValue:h(l).code,"onUpdate:modelValue":K[0]||(K[0]=C=>h(l).code=C),type:"text",name:"code",class:"block mt-1 w-1/2",inputmode:"numeric",autofocus:"",autocomplete:"one-time-code",onKeyup:R(V,["enter"])},null,8,["modelValue","onKeyup"]),n(L,{message:h(l).errors.code,class:"mt-2"},null,8,["message"])])):f("",!0)])):f("",!0),m.value.length>0&&!e.value?(t(),a("div",me,[pe,c("div",_e,[(t(!0),a(j,null,z(m.value,C=>(t(),a("div",{key:C},i(C),1))),128))])])):f("",!0)])):f("",!0),c("div",ve,[h(p)?(t(),a("div",ye,[n(g,{onConfirmed:V},{default:o(()=>[e.value?(t(),w(F,{key:0,type:"button",class:k(["mr-3",{"opacity-25":u.value}]),disabled:u.value},{default:o(()=>[r(i(s.$t("profile.confirm")),1)]),_:1},8,["class","disabled"])):f("",!0)]),_:1}),n(g,{onConfirmed:H},{default:o(()=>[m.value.length>0&&!e.value?(t(),w($,{key:0,class:"mr-3"},{default:o(()=>[r(" Regenerate Recovery Codes ")]),_:1})):f("",!0)]),_:1}),n(g,{onConfirmed:T},{default:o(()=>[m.value.length===0&&!e.value?(t(),w($,{key:0,class:"mr-3"},{default:o(()=>[r(" Show Recovery Codes ")]),_:1})):f("",!0)]),_:1}),n(g,{onConfirmed:P},{default:o(()=>[e.value?(t(),w($,{key:0,class:k({"opacity-25":d.value}),disabled:d.value},{default:o(()=>[r(i(s.$t("profile.cancel")),1)]),_:1},8,["class","disabled"])):f("",!0)]),_:1}),n(g,{onConfirmed:P},{default:o(()=>[e.value?f("",!0):(t(),w(J,{key:0,class:k({"opacity-25":d.value}),disabled:d.value},{default:o(()=>[r(i(s.$t("profile.disable")),1)]),_:1},8,["class","disabled"]))]),_:1})])):(t(),a("div",he,[n(g,{onConfirmed:S},{default:o(()=>[n(F,{type:"button",class:k({"opacity-25":u.value}),disabled:u.value},{default:o(()=>[r(i(s.$t("profile.two_factor_authentication.enable")),1)]),_:1},8,["class","disabled"])]),_:1})]))])]),_:1}))}};export{Fe as default};
